//@version=6
indicator("Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ†ÙŠØ© â€“ VWAP + Ø§Ù„Ø³ÙŠÙˆÙ„Ø©", "40Cycle VWAP", overlay = true, max_lines_count = 500, max_labels_count = 500)

// Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
cycleLen   = input.int(40, "Ø·ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù…ÙˆØ¹)", minval = 5)
useColorBg = input.bool(true, "ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù†Ø¯ ÙƒÙ„ Ø¯ÙˆØ±Ø©ØŸ")
showText   = input.bool(true, "Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø§Øª (Ø¯Ø®ÙˆÙ„ / Ø®Ø±ÙˆØ¬)ØŸ")

// Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª
src     = close
vwapVal = ta.vwap(src)

// ÙƒÙ„ Ø´Ù…Ø¹Ø© Ø±Ù‚Ù…Ù‡Ø§ Ù…Ù† Ù…Ø¶Ø§Ø¹ÙØ§Øª 40 Ù†Ø¹ØªØ¨Ø±Ù‡Ø§ Ø´Ù…Ø¹Ø© Ø¯ÙˆØ±Ø©
cycleBar = bar_index % cycleLen == 0

// âœ… Ø¹Ù„Ø§Ù…Ø© ØªØ£ÙƒÙŠØ¯ Ø£Ù† Ø§Ù„Ù…Ø¤Ø´Ø± Ø´ØºØ§Ù„: Ø·Ø¨Ø§Ø¹Ø© "40" Ø¹Ù†Ø¯ ÙƒÙ„ Ø¯ÙˆØ±Ø©
plotshape(
     cycleBar,
     title     = "40-cycle mark",
     text      = "40",
     style     = shape.triangledown,
     location  = location.abovebar,
     size      = size.tiny
)

// ðŸ”¹ Ø´Ø±ÙˆØ· Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬:
// Ø¯Ø®ÙˆÙ„: Ø´Ù…Ø¹Ø© Ø¯ÙˆØ±Ø© + Ø¥ØºÙ„Ø§Ù‚ ÙÙˆÙ‚ VWAP + Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
// Ø®Ø±ÙˆØ¬: Ø´Ù…Ø¹Ø© Ø¯ÙˆØ±Ø© + Ø¥ØºÙ„Ø§Ù‚ ØªØ­Øª VWAP + Ø­Ø¬Ù… Ø£Ù‚Ù„ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
bullCond = cycleBar and close > vwapVal and volume > volume[1]
bearCond = cycleBar and close < vwapVal and volume < volume[1]

// Ø±Ø³Ù… Ø®Ø· Ø¹Ù…ÙˆØ¯ÙŠ Ø®ÙÙŠÙ Ø¹Ù†Ø¯ ÙƒÙ„ Ø¯ÙˆØ±Ø©
if cycleBar
    line.new(bar_index, low, bar_index, high, extend = extend.none, style = line.style_dotted)

// ÙƒØªØ§Ø¨Ø© "Ø¯Ø®ÙˆÙ„" / "Ø®Ø±ÙˆØ¬" Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø±Øª
if showText and bullCond
    label.new(bar_index, high, "Ø¯Ø®ÙˆÙ„", style = label.style_label_up, textalign = text.align_center)

if showText and bearCond
    label.new(bar_index, low, "Ø®Ø±ÙˆØ¬", style = label.style_label_down, textalign = text.align_center)

// ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©
bgcolor(useColorBg and cycleBar ? color.new(color.gray, 90) : na)
