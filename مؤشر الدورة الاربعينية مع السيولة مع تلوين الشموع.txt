//@version=6
indicator("Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ†ÙŠØ© â€“ VWAP + Ø³ÙŠÙˆÙ„Ø© (ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø´Ù…ÙˆØ¹)", "40Cycle Liquidity", overlay = true, max_lines_count = 500, max_labels_count = 500)

// Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
cycleLen   = input.int(40, "Ø·ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù…ÙˆØ¹)", minval = 5)
useColorBg = input.bool(true, "ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù†Ø¯ ÙƒÙ„ Ø¯ÙˆØ±Ø©ØŸ")
showText   = input.bool(true, "Ø¥Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø§Øª (Ø¯Ø®ÙˆÙ„ / Ø®Ø±ÙˆØ¬)ØŸ")
colorBars  = input.bool(true, "ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø´Ù…ÙˆØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŸ")

// Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª
src     = close
vwapVal = ta.vwap(src)

// Ø´Ù…Ø¹Ø© Ø¯ÙˆØ±Ø© ÙƒÙ„ 40 Ø´Ù…Ø¹Ø©
cycleBar = bar_index % cycleLen == 0

// Ø³ÙŠÙˆÙ„Ø© Ø´Ø±Ø§Ø¡ / Ø¨ÙŠØ¹
buyLiquidity  = close > vwapVal and volume > volume[1]
sellLiquidity = close < vwapVal and volume < volume[1]

// Ø´Ø±ÙˆØ· Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ (Ù…Ø±Ø¨ÙˆØ·Ø© Ø¨Ø§Ù„Ø¯ÙˆØ±Ø©)
bullCond = cycleBar and buyLiquidity
bearCond = cycleBar and sellLiquidity

// ðŸ”¹ ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø´Ù…ÙˆØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
barcolor(
     colorBars
     ? buyLiquidity  ? color.new(color.green, 0)
       : sellLiquidity ? color.new(color.red, 0)
       : na
     : na
)

// Ø¹Ù„Ø§Ù…Ø© 40 Ù„Ù„ØªØ£ÙƒØ¯
plotshape(
     cycleBar,
     title     = "40-cycle mark",
     text      = "40",
     style     = shape.triangledown,
     location  = location.abovebar,
     size      = size.tiny
)

// Ø®Ø· Ø¹Ù…ÙˆØ¯ÙŠ Ø¹Ù†Ø¯ ÙƒÙ„ Ø¯ÙˆØ±Ø©
if cycleBar
    line.new(bar_index, low, bar_index, high, extend = extend.none, style = line.style_dotted)

// ÙƒØªØ§Ø¨Ø© Ø¯Ø®ÙˆÙ„ / Ø®Ø±ÙˆØ¬
if showText and bullCond
    label.new(bar_index, high, "Ø¯Ø®ÙˆÙ„", style = label.style_label_up, textalign = text.align_center)

if showText and bearCond
    label.new(bar_index, low, "Ø®Ø±ÙˆØ¬", style = label.style_label_down, textalign = text.align_center)

// ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ø¯ÙˆØ±Ø©
bgcolor(useColorBg and cycleBar ? color.new(color.gray, 90) : na)
