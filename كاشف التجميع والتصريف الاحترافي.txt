//@version=5
indicator("كاشف التجميع والتصريف الاحترافي", overlay=true)

// الشروط العامة
body = math.abs(close - open)
upperWick = high - math.max(close, open)
lowerWick = math.min(close, open) - low
volumeMA = ta.sma(volume, 20)

// شروط التجميع الاحترافي
isAccumulation = (volume > volumeMA * 1.5) and (close > open) and (lowerWick > body) and (body < (high - low) * 0.4)

// شروط التصريف الاحترافي
isDistribution = (volume > volumeMA * 1.5) and (close < open) and (upperWick > body) and (body < (high - low) * 0.4)

// رسم المناطق بالألوان
bgcolor(isAccumulation ? color.new(color.green, 85) : na)
bgcolor(isDistribution ? color.new(color.red, 85) : na)

// أسهم الإشارة
plotshape(isAccumulation, title="إشارة تجميع", location=location.belowbar, color=color.green, style=shape.arrowup, size=size.small)
plotshape(isDistribution, title="إشارة تصريف", location=location.abovebar, color=color.red, style=shape.arrowdown, size=size.small)